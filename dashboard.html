<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>MindGraph API Dashboard</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    body {
      margin: 0;
      background: #0b0b0f;
      color: #f5f5f5;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, sans-serif;
      padding: 20px;
    }

    .container {
      max-width: 1200px;
      margin: 0 auto;
    }

    .header {
      text-align: center;
      margin-bottom: 30px;
    }

    .api-key-section {
      background: #111;
      padding: 20px;
      border-radius: 8px;
      margin-bottom: 30px;
      border: 1px solid #222;
    }

    .api-key-section input {
      width: 100%;
      padding: 10px;
      background: #18181b;
      color: #f5f5f5;
      border: 1px solid #333;
      border-radius: 6px;
      font-size: 16px;
      margin-bottom: 10px;
    }

    .api-key-section button {
      background: #06b6d4;
      color: #000;
      border: none;
      padding: 10px 20px;
      border-radius: 6px;
      font-weight: 600;
      cursor: pointer;
      width: 100%;
    }

    .api-key-section button:hover {
      opacity: 0.9;
    }

    .stats-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 20px;
      margin-bottom: 30px;
    }

    .stat-card {
      background: #111;
      padding: 20px;
      border-radius: 8px;
      border: 1px solid #222;
      text-align: center;
    }

    .stat-value {
      font-size: 2em;
      font-weight: bold;
      color: #06b6d4;
      margin-bottom: 5px;
    }

    .stat-label {
      color: #ccc;
      font-size: 0.9em;
    }

    .charts-section {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
      gap: 20px;
      margin-bottom: 30px;
    }

    .chart-container {
      background: #111;
      padding: 20px;
      border-radius: 8px;
      border: 1px solid #222;
    }

    .chart-title {
      text-align: center;
      margin-bottom: 20px;
      color: #f5f5f5;
    }

    .hidden {
      display: none;
    }

    .loading {
      text-align: center;
      color: #ccc;
    }

    .error {
      background: #ff4444;
      color: white;
      padding: 10px;
      border-radius: 6px;
      margin-bottom: 20px;
      text-align: center;
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <h1>MindGraph API Dashboard</h1>
      <p>Monitor your API usage and token consumption</p>
    </div>

    <div class="api-key-section">
      <input type="password" id="apiKey" placeholder="Enter your API key" />
      <button onclick="loadDashboard()">Load Dashboard</button>
    </div>

    <div id="error" class="error hidden"></div>

    <div id="dashboard" class="hidden">
      <div class="stats-grid">
        <div class="stat-card">
          <div class="stat-value" id="totalRequests">0</div>
          <div class="stat-label">Total Requests</div>
        </div>
        <div class="stat-card">
          <div class="stat-value" id="successfulRequests">0</div>
          <div class="stat-label">Successful Requests</div>
        </div>
        <div class="stat-card">
          <div class="stat-value" id="failedRequests">0</div>
          <div class="stat-label">Failed Requests</div>
        </div>
        <div class="stat-card">
          <div class="stat-value" id="totalTokens">0</div>
          <div class="stat-label">Total Tokens Used</div>
        </div>
        <div class="stat-card">
          <div class="stat-value" id="promptTokens">0</div>
          <div class="stat-label">Prompt Tokens</div>
        </div>
        <div class="stat-card">
          <div class="stat-value" id="completionTokens">0</div>
          <div class="stat-label">Completion Tokens</div>
        </div>
        <div class="stat-card">
          <div class="stat-value" id="rateLimitHits">0</div>
          <div class="stat-label">Rate Limit Hits</div>
        </div>
        <div class="stat-card">
          <div class="stat-value" id="avgResponseTime">0ms</div>
          <div class="stat-label">Avg Response Time</div>
        </div>
        <div class="stat-card">
          <div class="stat-value" id="estimatedCost">$0.00</div>
          <div class="stat-label">Estimated Cost (GPT-4)</div>
        </div>
      </div>

      <div class="charts-section">
        <div class="chart-container">
          <div class="chart-title">Daily Usage (Last 30 Days)</div>
          <canvas id="usageChart"></canvas>
        </div>
      </div>
    </div>

    <div id="loading" class="loading hidden">
      Loading dashboard data...
    </div>
  </div>

  <script>
    let usageChart = null;
    let modelsChart = null;

    async function loadDashboard() {
      const apiKey = document.getElementById('apiKey').value.trim();
      if (!apiKey) {
        showError('Please enter your API key');
        return;
      }

      document.getElementById('loading').classList.remove('hidden');
      document.getElementById('error').classList.add('hidden');
      document.getElementById('dashboard').classList.add('hidden');

      try {
        const response = await fetch('https://mindgraph-api.onrender.com/v1/user/analytics', {
          headers: {
            'Authorization': `Bearer ${apiKey}`
          }
        });

        if (!response.ok) {
          throw new Error(`Failed to load data: ${response.status} ${response.statusText}`);
        }

        const data = await response.json();
        displayData(data);
      } catch (error) {
        showError(error.message);
      } finally {
        document.getElementById('loading').classList.add('hidden');
      }
    }

    function displayData(data) {
      // Update stats
      document.getElementById('totalRequests').textContent = data.total_requests;
      document.getElementById('successfulRequests').textContent = data.successful_requests;
      document.getElementById('failedRequests').textContent = data.failed_requests;
      document.getElementById('totalTokens').textContent = data.total_tokens_used.toLocaleString();
      document.getElementById('promptTokens').textContent = data.prompt_tokens_used.toLocaleString();
      document.getElementById('completionTokens').textContent = data.completion_tokens_used.toLocaleString();
      document.getElementById('rateLimitHits').textContent = data.rate_limit_hits;
      document.getElementById('avgResponseTime').textContent = `${data.average_response_time.toFixed(2)}ms`;

      // Calculate estimated cost (pricing: $0.01/1K input, $0.04/1K output)
      const inputCost = (data.prompt_tokens_used / 1000) * 0.01;
      const outputCost = (data.completion_tokens_used / 1000) * 0.04;
      const totalCost = inputCost + outputCost;
      document.getElementById('estimatedCost').textContent = `$${totalCost.toFixed(4)}`;

      // Create/update charts
      createUsageChart(data.daily_usage);

      document.getElementById('dashboard').classList.remove('hidden');
    }

    function createUsageChart(dailyData) {
      const ctx = document.getElementById('usageChart').getContext('2d');

      if (usageChart) {
        usageChart.destroy();
      }

      const labels = dailyData.map(d => new Date(d.date).toLocaleDateString());
      const requests = dailyData.map(d => d.requests);
      const tokens = dailyData.map(d => d.tokens);

      usageChart = new Chart(ctx, {
        type: 'line',
        data: {
          labels: labels,
          datasets: [{
            label: 'Requests',
            data: requests,
            borderColor: '#06b6d4',
            backgroundColor: 'rgba(6, 182, 212, 0.1)',
            yAxisID: 'y',
          }, {
            label: 'Tokens',
            data: tokens,
            borderColor: '#ff6b6b',
            backgroundColor: 'rgba(255, 107, 107, 0.1)',
            yAxisID: 'y1',
          }]
        },
        options: {
          responsive: true,
          scales: {
            y: {
              type: 'linear',
              display: true,
              position: 'left',
              title: {
                display: true,
                text: 'Requests'
              }
            },
            y1: {
              type: 'linear',
              display: true,
              position: 'right',
              title: {
                display: true,
                text: 'Tokens'
              },
              grid: {
                drawOnChartArea: false,
              },
            }
          }
        }
      });
    }

    function showError(message) {
      document.getElementById('error').textContent = message;
      document.getElementById('error').classList.remove('hidden');
    }

    // Allow pressing Enter in API key field
    document.getElementById('apiKey').addEventListener('keypress', function(e) {
      if (e.key === 'Enter') {
        loadDashboard();
      }
    });
  </script>
</body>
</html>